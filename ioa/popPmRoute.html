<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="./bootstrap.css" rel="stylesheet">
    <script src="js/jq.js"></script>
    <script src="./bootstrap.js"></script>
    <script src="./prts_info.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        *{
           color:black;
        }
        .border{
           padding-left:5px;
           padding-right:5px;
        }
        #date{
           width:690px;
           text-align:center;
           padding:10px 0;
        }
        .childTable{ 
            margin: 10px;
        }
    </style>
</head>
<body>
    <div id="main">
        <div id="date" style="width:690px;text-align:center"></div>
        <div id="table" style="margin-left:90px;display: flex;"></div>
    </div>
</body>
</html>
<script>
    //alert(prtObjInfo["Ma, Cui Hua"])
    let orderBy=0; //if 0 
    let today=new Date();
    let todayDate=(today.getMonth()+1)+'-'+today.getDate()+'-'+today.getFullYear();
        

    (function($){
        $.getUrlParam = function(name){
            var reg¬†= new RegExp("(^|&)" +¬†name +"=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r!=null) return unescape(r[2]); return null;
        }
    })(jQuery);

    function whichRoom(prt){
        let tempPrt="{@}"+prt

        if(prtObjInfo[prt]){
            let room=prtObjInfo[prt].room
            
            room=room==1?"‚òÄ":room==2?"‚ú®":"üåô"
            
            tempPrt=room+tempPrt
        }else{
            tempPrt="üòÑ"+tempPrt
        }

        return tempPrt;
    }
    function isWheelchair(prt){

        return "-";
    }

    function createTable(arr,isRoom){
        let boder_style='border-secondary';
        let bg_style='bg-dark-subtle';
        let tableHtml=""
        if(isRoom){
            //$("#date").html(".")
            let tempTableHtml1 = `<table style="border:1px"><tr><th colspan="3" style="text-align: center"> `
            let tempTableHtml2=todayDate+`</th></tr><tr><!--<th class="border border-dark ${bg_style}"></th>--><th class="border border-dark ${bg_style}">Prt</th><th class="border border-dark ${bg_style}">Rt#</th><th class="border border-dark ${bg_style}">W</th></tr>`;
            
            let sunTable=`<div class="childTable" id="sunRoom">`+tempTableHtml1+`‚òÄSun Room `+tempTableHtml2;            
            let starTable=`<div class="childTable" id="starRoom">`+tempTableHtml1+`‚ú®Star Room `+tempTableHtml2;
            let moonTable=`<div class="childTable" id="moonRoom">`+tempTableHtml1+`üåôMoon Room `+tempTableHtml2;
            let otherTable=tempTableHtml1+`other<br>`+tempTableHtml2;
            
            for(let i=0,j=1;i<arr.length;i++){
                let room=arr[i][0].split("{@}")[0]; // ‚òÄ‚ú®üåô
                let prtTr=`<tr style="color:black">
                    <!--<td>${i}</td>-->
                    <td class="border border-dark">${arr[i][0].replace("{@}","")}</td>
                    <td class="border border-dark">${arr[i][1]}</td>
                    <td class="border border-dark">${arr[i][2]}</td></tr>`
                
                if(room=="‚òÄ"){
                    sunTable+=prtTr;
                }else if(room=="‚ú®"){
                    starTable+=prtTr;
                }else if(room=="üåô"){
                    moonTable+=prtTr;
                }else{
                    otherTable+=prtTr;
                }
            }
            sunTable+="</table></div>";
            starTable+="</table></div>";
            if(tempTableHtml1+`other<br>`+tempTableHtml2==otherTable)otherTable=""
            moonTable+="</table><br>"+otherTable+"<div>";

            tableHtml=sunTable+starTable+moonTable
            
        }else{
            $("#date").html(todayDate)
            tableHtml = `<table style="border:1px">
                             <tr>
                                <!--<th class="border border-dark ${bg_style}"></th>-->
                                <th class="border border-dark ${bg_style}">Prt</th>
                                <th class="border border-dark ${bg_style}">Rt#</th>
                                <th class="border border-dark ${bg_style}">W</th>
      
                                <th class="border border-dark ${bg_style}">&nbsp;</th>
                                <!--<th class="border border-dark ${bg_style}"></th>-->
                                <th class="border border-dark ${bg_style}">Prt</th>
                                <th class="border border-dark ${bg_style}">Rt#</th>
                                <th class="border border-dark ${bg_style}">W</th>
                             </tr>`;
    
            let row=parseInt(arr.length/2+.6)
            for(let i=0;i<row;i++){
                let r = parseInt(i + row);
                //left side
                tableHtml += `<tr style="color:black">
                    <!--<td>${i}</td>-->
                    <td class="border border-dark">${arr[i][0].replace("{@}","")}</td>
                    <td class="border border-dark">${arr[i][1]}</td>
                    <td class="border border-dark">${arr[i][2]}</td>
                    <td class="border border-dark ${bg_style}"></td>`
                //right side
                
                let r_prt="",r_rtNum="",r_wheelchair=""
                if(r<arr.length){
                    r_prt=arr[r][0];
                    r_rtNum=arr[r][1];
                    r_wheelchair=arr[r][2]
                    
                }
                tableHtml+=`<!--<td>${r}</td>-->
                    <td class="border border-dark">${r_prt.replace("{@}","")}</td>
                    <td class="border border-dark">${r_rtNum}</td>
                    <td class="border border-dark">${r_wheelchair}</td>
                `
            }
    
    
            tableHtml+="</table>"
        }
        $("#table").html(tableHtml)
    }

    $(function(){


        let param=$.getUrlParam("arr");
        let tableHtml="";
        let pmArr=eval(param)
        //console.log($.getUrlParam("date1")+"----------");
        if($.getUrlParam("date")!=null) todayDate=$.getUrlParam("date")
        //console.log(param)

       

        // Â∞ÜÂéüÂßãÊï∞ÊçÆÁªÑÂêàÊàê‰∏Ä‰∏™ÊåâËΩ¶(Â∏¶‰∏äÊàøÂè∑)ÊéíÂ∫èÁöÑÊï∞ÁªÑ,Êñπ‰æøÂà∂Ë°®        
        let byRouteArr=[];
        for(let i=1;i<pmArr.length-1;i++){
            if(pmArr[i]===undefined) continue;
            for(let j=0;j<pmArr[i].length;j++){
                let tempPrt=pmArr[i][j]
                let r=i
                r=i==11?"Joe":i==12?"Wilson":r;
                byRouteArr.push([whichRoom(tempPrt),r,isWheelchair(tempPrt)]);
            }
        }
        // Êñ∞Âª∫‰∏Ä‰∏™ÊåâÂêçÊéíÂ∫èÁöÑÊï∞ÁªÑ
        let byNameArr=[...byRouteArr]
        byNameArr.sort()


        //console.log(byRouteArr,byRouteArr.length)
        
        
        let tableArr=[...byRouteArr];//Âà∂Ë°®Êó∂ÂÄôÁî®ÁöÑË°®
        createTable(tableArr)

        $("#date").click(function(){
            const FORM_NUMBER=6;
            $("#table").html("")
            console.log()
            if(orderBy%FORM_NUMBER==0){// by name only
                createTable(byNameArr)
                //console.log("byNameArr:"+byNameArr)
            }else if(orderBy%FORM_NUMBER==1){// by route
                createTable(byRouteArr)
                //console.log("byRouteArr:"+byRouteArr)
            }else if(orderBy%FORM_NUMBER==2){// by Room and name
                createTable(byNameArr,true)
                //console.log("byNameArr:"+byNameArr)
            }else if(orderBy%FORM_NUMBER==3){// by Sun Room
                createTable(byNameArr,true)
                $("#starRoom").hide()
                $("#moonRoom").hide()
                //console.log("byRouteArr:"+byRouteArr)
            }else if(orderBy%FORM_NUMBER==4){// by Star Room
                createTable(byNameArr,true)
                $("#sunRoom").hide()
                $("#moonRoom").hide()
                //console.log("byRouteArr:"+byRouteArr)
            }else if(orderBy%FORM_NUMBER==5){// by Moon Room
                createTable(byNameArr,true)
                $("#starRoom").hide()
                $("#sunRoom").hide()
                //console.log("byRouteArr:"+byRouteArr)
            }
            
            orderBy++;
        })
    })
</script>
