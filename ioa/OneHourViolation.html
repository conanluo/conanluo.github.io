<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>One Hour Violation</title>
    <!-- 引入 Bootstrap 样式 -->
    <link href="./bootstrap.css" rel="stylesheet">
    <!-- 引入 jQuery -->
    <script src="./js/jQuery.js"></script>
    <!-- 引入 Bootstrap JavaScript 插件 -->
    <script src="./bootstrap.js"></script>
</head>

<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-md-6">
                <!-- 添加label标签 -->
                <label for="tripsRecord">Trips Record:</label>
                <!-- 修改textarea的id为"tripsRecord" -->
                <textarea id="tripsRecord" class="form-control" rows="5"
                    placeholder="Enter Trips Record here...">Reference Number	Service Date	Appt Type	Division	Service Code	Service Name	Service Subtype	Cancel Reason	Cancel With Charge	Cancel Without Charge	Passenger	DOB	Member ID	Plan ID	LOB	Infectious Disease	Farmout	PU Location	PU Address	DO Location	DO Address	Distance (Miles)	Miles Override	PU Time Ordered	PU Time Actual	DO Time Ordered	DO Time Actual	Appt. Time	Driver	Vehicle ID	Partner Pay Status	Invoice Status	Farmout Pay Date	Farmout Rate	Total Charges	BillTo Contact ID	BillTo Name	PO Number	Reimbursee Contact ID	Reimbursee Name	Reimbursement Type	Reimbursement Service Date	Reimbursee Adreess	Reimbursement Note
PD1595553	03/01/2024	Clinic	CA04	80	DME & Rx			0	0	Christopher Bello	1949/6/5	14092	PP.490078	Pace		Secure Transportation Northern California	Christopher Bello	345 6th St #307, San Francisco, CA 94103, USA	IOA	3575 Geary Boulevard, San Francisco, CA 94118	3.5		9:20:00	8:56:00	9:45:00	10:23:58	10:00:00	Jerald Alejandro	IOA-19	Final	Pending		1		490078	IOA							
PD1894386	03/01/2024	Dialysis	CA04	3	Wheelchair			0	0	Gertrude Lee		PC15238	PP.490078	Pace		Secure Transportation Northern California	IOA	3575 Geary Boulevard, San Francisco, CA 94118	Gertrude Lee	259 Broad St, San Francisco, CA 94112, USA	6.6		15:30:00	16:02:48	16:10:27	17:05:53		Mauricio Reina	IOA-15	Final	Pending		0.07		490078	IOA							
PD1894430	03/01/2024	Center Attendance	CA04	1	Ambulatory			0	0	Pak C. Chu	1937/10/20	2210001651	PP.490078	Pace		Secure Transportation Northern California	Pak C. Chu	1790 9th Avenue, San Francisco, CA 94122	IOA	3575 Geary Boulevard, San Francisco, CA 94118	2.7		9:27:18	9:42:28	9:45:00	9:52:54	10:00:00	Bert Reid	IOA-11	Final	Pending		0.03		490078	IOA							
PD1894376	03/01/2024	Dialysis	CA04	1	Ambulatory		Cancelled at Door	1	0	Hi Huynh	1942/4/22	2210001891	PP.490078	Pace		Secure Transportation Northern California	IOA	3575 Geary Boulevard, San Francisco, CA 94118	Hi Huynh	848 Kearny Street #713, San Francisco, CA 94108	3.6		15:30:00	15:47:42	15:54:19			Jerald Alejandro	IOA-19	Final	Pending		0		490078	IOA							
PD1894119	03/01/2024	Clinic	CA04	1	Ambulatory		Return Not Needed	0	1	Ly K Dang		PC31425	PP.490078	Pace		Secure Transportation Northern California	IOA	3575 Geary Boulevard, San Francisco, CA 94118	Ly K Dang	2535 35th Ave, San Francisco, CA 94116, USA	5		15:30:00		15:55:00			Yingyang Chen	IOA-16	Final	Pending		0		490078	IOA							</textarea>
            </div>
            <div class="col-md-6">
                <!-- 添加label标签 -->
                <label for="geoTabRecord">GeoTab Record:</label>
                <!-- 修改textarea的id为"geoTabRecord" -->
                <textarea id="geoTabRecord" class="form-control" rows="5"
                    placeholder="Enter GeoTab Record here...">Device	Device Group						Start Date		Stop Date	Driving Duration		Distance		Start Location	Stop Location			
IOA-11	Vehicle, IOA - San Francisco						Mar 01, 2024 6:59:16 AM		Mar 01, 2024 7:05:41 AM	0:06		3		2100 Carroll Ave, San Francisco, CA 94124, USA	1100 26th St, San Francisco, CA 94107, USA			
IOA-11	Vehicle, IOA - San Francisco						Mar 01, 2024 7:12:15 AM		Mar 01, 2024 7:21:47 AM	0:09		2		1100 26th St, San Francisco, CA 94107, USA	1458 21st Ave, San Francisco, CA 94122, USA			
IOA-11	Vehicle, IOA - San Francisco						Mar 01, 2024 8:18:49 AM		Mar 01, 2024 8:51:00 AM	0:32		10		1458 21st Ave, San Francisco, CA 94122, USA	1423 32nd Ave, San Francisco, CA 94122, USA			
IOA-11	Vehicle, IOA - San Francisco						Mar 01, 2024 8:57:06 AM		Mar 01, 2024 9:02:17 AM	0:05		1		1423 32nd Ave, San Francisco, CA 94122, USA	1927 32nd Ave, San Francisco, CA 94116, USA			
IOA-11	Vehicle, IOA - San Francisco						Mar 01, 2024 9:06:32 AM		Mar 01, 2024 9:09:50 AM	0:03		1		1927 32nd Ave, San Francisco, CA 94116, USA	IOA - San Francisco, CA: 3575 Geary Blvd, San Francisco, CA 94118, USA			
IOA-11	Vehicle, IOA - San Francisco						Mar 01, 2024 9:13:29 AM		Mar 01, 2024 9:57:49 AM	0:44		7		IOA - San Francisco, CA: 3575 Geary Blvd, San Francisco, CA 94118, USA	IOA - San Francisco, CA: 3575 Geary Blvd, San Francisco, CA 94118, USA</textarea>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-md-6">
                <!-- 添加一个成功样式的按钮 -->
                <button id="correctButton" type="button" class="btn btn-success">Correct them</button>
            </div>
        </div>
        <div id="showTable"></div>
            <!-- 引入 Bootstrap JavaScript 插件 -->
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>

</div>
</div>



<script>
    $(document).ready(function () {
        // 点击按钮时的事件
        $("#correctButton").click(function () {     
            // 获取两个textarea框的内容
            var tripsRecord = $("#tripsRecord").val().trim();
            var geoTabRecord = $("#geoTabRecord").val().trim();
            // 分别判断两个textarea框是否为空，只要有一个为空就显示提示框
            if (tripsRecord === "") {
                // 使用Bootstrap的提示框
                alert("Please enter text in Trips Record.");
            } else if (geoTabRecord === "") {
                // 使用Bootstrap的提示框
                alert("Please enter text in GeoTab Record.");
            } else {
// =============处理trips Record表的部分  开始===============================       
                // 将Trip Record数据转化成对象形式                    
                let tripsTitlesObj = { "Service Date": {}, "Cancel Reason": {}, "Service Code": {}, "Passenger": {}, "Vehicle ID": {}, "PU Address": {}, "DO Address": {}, "PU Time Actual": {}, "DO Time Actual": {} };// 将列名转换成对应的位置eg.{ "Service Date":{Date:"2024/2/3",index:1}}, "Service Code":4 .....},方便使用
                let tripsReName = "date,cancel,serverCode,prtName,vanNum,puAddr,doAddr,puTime,doTime".split(",")
                // 将Trip Record 转换成对象形式
                let tripsRecordArr = tripsRecord.split("\n"); // 按照行分段保存
                Object.keys(tripsTitlesObj).forEach((title, index) => tripsTitlesObj[title] = { "name": tripsReName[index], "index": tripsRecordArr[0].split("\t").indexOf(title) })// tripsRecordArr第一行是列名,并且将对应列名的位置保存到titleObj中

                tripsRecordArr.shift()

                // Trip Recoed 以对象形式保存
                let tripsRecordObjArr = [] // {"date":"2024/03/01","code":3 .... }
                tripsRecordArr.forEach(obj => {
                    let tempTrip = obj.split("\t");
                    let tempObj = {};

//tempObj[tripsTitlesObj["Service Date"].name]=tempTrip[tripsTitlesObj["Service Date"].index];

                    Object.keys(tripsTitlesObj).forEach(key => tempObj[tripsTitlesObj[key].name] = tempTrip[tripsTitlesObj[key].index]);
                    tempObj.itineris = ((new Date("1980-01-01T" + mDate(tempObj.doTime)) - new Date("1980-01-01T" + mDate(tempObj.puTime))) / 3600000).toFixed(2)
                    if (tempObj.cancel == "" && (tempObj.serverCode != 80) && tempObj.puTime!="" && tempObj.doTime!="" && tempObj.itineris>=1)
                        tripsRecordObjArr.push(tempObj)
                    //console.log(tempTrip)
                });
                tripsRecordObjArr.sort((a, b) => {
                    if (a.vanNum < b.vanNum) return -1;
                    if (a.vanNum > b.vanNum) return 1;
                    if (a.date < b.date) return -1;
                    if (a.date > b.date) return 1;
                    return 0;
                })
//$("#geoTabRecord").val(JSON.stringify(tripsRecordObjArr))
$("#showTable").html(createTableHtml([...tripsReName, "itineris"], tripsRecordObjArr)) //显示Trips Record 表
// =============处理trips Record表的部分  结束===============================  
// =============处理GeoTab Record表的部分  开始=============================== 
                let geoTabTitlesObj={"Device":{},"Start Date":{},"Stop Date":{},"Driving Duration":{},"Start Location":{},"Stop Location":{}}    // 将列名转换成对应的位置eg.{ "Device":{vanNum:"ioa-11",index:1}}, .....},方便使用
                let geoTabReName="vanNum,bDate,eDate,GeoTab,puAddr,doAddr".split(",")
                // 将geoTab Record 转换对象形式          
                let geoTabRecordArr = geoTabRecord.split("\n");
                Object.keys(geoTabTitlesObj).forEach((title,index) => geoTabTitlesObj[title]={"name":geoTabReName[index],"index":geoTabRecordArr[0].split("\t").indexOf(title)})// geoTabRecordArr第一行为列名,并且将对应列名的位置保存到titleObj中
                geoTabRecordArr.shift();
//console.log(JSON.stringify(geoTabTitlesObj))
                // GeoTab Record 以对象形式保存
                let geoTabRecordObjArr = [];
                geoTabRecordArr.forEach(obj=>{
                    let tempTrip = obj.split("\t");
                    let tempObj = {};
                    Object.keys(geoTabTitlesObj).forEach(key => tempObj[geoTabTitlesObj[key].name] = tempTrip[geoTabTitlesObj[key].index]);
                    geoTabRecordObjArr.push(tempObj);

                })
$("#showTable").html($("#showTable").html()+createTableHtml([...geoTabReName], geoTabRecordObjArr)) //geoTab Record 表
// =============处理GeoTab Record表的部分  结束=============================== 

// 新建一个table.  Date, Prt Name, Address, Van Number, driver Duration, GeoTab Duration, reason
                let finialTitles="Date,Van Number,Prt Name,Address,driver Duration,GeoTab Duration,reason".split(",")
                let finialObjArr=[];
                

            }
            

        });
    });

    //新建table
    function createTableHtml(titles, items) {
        let html = `<table class="table table-bordered table-striped">
                    <thead class="bg-dark text-white">
                        <tr><th>#</th>`
        for (let i = 0; i < titles.length; i++) html += (titles[i] == "cancel" || titles[i] == "serverCode") ? "" : `<th>${titles[i]}</th>`
        html += `</tr></thead>`
        for (let i = 0, colNum = 0; i < items.length; i++) {
            // if (items[i].itineris < 1) continue;
            html += `<tr${colNum % 2 == 0 ? ' class="bg-light"' : ""}>`
            colNum++;
            html += `<td>${colNum}</td>`
            for (let j = 0; j < titles.length; j++) {
                if (titles[j] == "cancel" || titles[j] == "serverCode") continue
                html += `<td>${items[i][titles[j]]}</td>`
            }
            html += "</tr>"
        }


        html += `</tbody>
                </table>`
        return html
    }

    //时间处理处理
    function mDate(dateString) {
        let nDate = dateString
        if (nDate.length == 7) nDate = "0" + nDate;
        return nDate
    }
</script>
</body>

</html>
